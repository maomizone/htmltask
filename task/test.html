
<!DOCTYPE html>
<html style="height: 100%">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="js/jquery-3.2.1.min.js"></script>
    <style type="text/css">
        .wtips{
            position:absolute;
            left:0;
            top:0;
            background-color:rgba(0,0,0,0.65);
            width:100%;
            height:100%;
            z-index:100;
        }
        .wtips img{
            width:90%;
            height:50%;
            margin:1% 5%;
        }
    </style>

</head>
<script type="text/javascript">
    var isAndroid;
    var isIOS;
    var id;

    function load() {
        var ua = window.navigator.userAgent.toLowerCase();
        var u = navigator.userAgent;
        isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //g
        isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
        var micromessenger = ua.match(/MicroMessenger/i);
        var weixin = micromessenger == 'micromessenger'?true:false;

        // 判断是否是微信内置浏览器，是就显示在浏览器中打开
        if (weixin) {
            alert("是微信内置浏览器");
            if (isAndroid) {
                //这个是安卓操作系统
                document.getElementById("tips_weix").src="./img/android.png"
            }
            if (isIOS) {
                //这个是ios操作系统
                document.getElementById("tips_weix").src="./img/ios.png"
            }
            document.getElementById("tipsdiv").style.display="";
        }

        // Safari 浏览器跳转IOS下载页
//        if (/webkit/i.test(ua) && !(/chrome/i.test(ua) && /webkit/i.test(ua) && /mozilla/i.test(ua))) {
//
//            document.getElementById("down").href = "苹果同事提供下载地址";
//        }

//        if(!weixin){
//            var src = window.location.href;
//            var I = src.substr(src.indexOf("?id=") + 4).length;
//            var T = src.indexOf("?id=");
//            if (0 >= T) return "";
//            if (I == src.length) return -1;
//            id = src.substr(src.indexOf("?id=") + 4);
//            var test = document.getElementById("test");
//// 		alert("id =  "+id);
//// 		test.href = "dfish://zy.app/openfish?roomid="+id;
//// 		alert("a标签的href ： "+test.href);
////            test.onclick=openApp("要监听的URL scheme协议");
//            test.onclick=openApp("scheme1://host1:8080/path1?query1=1&query2=true");
//        }
//    }
//        var down = document.getElementById("down");
//        down.onclick = openApp("scheme1://host1:8080/path1?query1=1&query2=true");
    }

    //判断手机上是否安装了app，如果安装直接打开，如果没安装，跳转到下载页面
    function openApp() {
        alert("openApp");
//        var url = "scheme1://host1:8080/path1?query1=1&query2=true";
//        if (isAndroid) {
//            alert("是Android");
//            var timeout, t = 1000, hasApp = true;
//            var openScript = setTimeout(function () {
//                if (!hasApp) {
////                        var durl = "安卓同事提供下载地址";
//                    var durl = "https://fir.im/mwcp";
//                    window.location.href = durl;
//                }
//                document.body.removeChild(ifr);
//            }, 2000);
//
//            var t1 = Date.now();
//            var ifr = document.createElement("iframe");
//            ifr.setAttribute('src', url);
//            ifr.setAttribute('style', 'display:none');
//            document.body.appendChild(ifr);
//            timeout = setTimeout(function () {
//                var t2 = Date.now();
//                if (!t1 || t2 - t1 < t + 100) {
//                    hasApp = false;
//                }
//            }, t);
//        }
//        if (isIOS) {
//            document.getElementById("test").href = url;
//            document.getElementById("test").click();
//        }

        //这个是安卓操作系统
        if (isAndroid) {
            //安卓app的scheme协议
            window.location.href = 'scheme1://host1:8080/path1?query1=1&query2=true';
            setTimeout(function(){
                var hidden = window.document.hidden || window.document.mozHidden || window.document.msHidden ||window.document.webkitHidden;
                if(typeof hidden =="undefined" || hidden ==false){
                    //应用宝下载地址
                    window.location.href ="https://fir.im/mwcp";
                }
            }, 2500);
        }
        //这个是ios操作系统
        if (isIOS) {
            //ios的scheme协议
            window.location.href = 'zjmobile://platformapi/startapp';
            setTimeout(function(){
                var hidden = window.document.hidden || window.document.mozHidden || window.document.msHidden ||window.document.webkitHidden;
                if(typeof hidden =="undefined" || hidden ==false){
                    //App store下载地址
                    window.location.href =
                        "https://itunes.apple.com/us/app/zhe-jiang-yi-dong-shou-ji/id898243566#weixin.qq.com";
                }
            }, 2500);
            return false;
        }
    }
</script>

<body onload="load()"  style="height: 100%" id="body">
<div id='down' onclick="openApp()" ><img height="64px" width="64px" src="./img/cat.png"></div>

<!--如果是微信内置浏览器会显示以下图标-->
<div id="tipsdiv" class="wtips" style="display: none">
    <p>请在浏览器中打开</p>
    <img src="img/android.png">
</div>
</body>
</html>

