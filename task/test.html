
<!DOCTYPE html>
<html style="height: 100%">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="js/jquery-3.2.1.min.js"></script>
    <style type="text/css">
        .wtips{
            position:absolute;
            left:0;
            top:0;
            background-color:rgba(0,0,0,0.65);
            width:100%;
            height:100%;
            z-index:100;
        }
        .wtips p{
            font-size: 40px;
            margin-top: 45%;
            margin-left: 30%;
        }
        #down{
            padding-top: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>

</head>
<script type="text/javascript">
    var isAndroid;
    var isIOS;
    var downloader;
    var andScheme = 'scheme1://host1:8080/path1?query1=1&query2=true';  // 需要打开的app scheme 地址
    var iosScheme = 'schemeDemo://host1:8080/path1?query1=1&query2=true';  // 需要打开的app scheme 地址
    var iosDownload='https://hxjdown.ychel.com/sycl';  // 如果打开scheme失效的app下载地址
    var andDownload = 'https://fir.im/mwcp';

    function load() {
        var ua = window.navigator.userAgent.toLowerCase();
        var u = navigator.userAgent;
        isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //g
        isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
        var micromessenger = ua.match(/MicroMessenger/i);
        var weixin = micromessenger == 'micromessenger' ? true : false;

        // 判断是否是微信内置浏览器，是就显示在浏览器中打开
        if (weixin) {
            document.getElementById("tipsdiv").style.display = "";
            document.getElementById("tipsp").innerHTML= isIOS ? "请用Safari浏览器打开" : "请用其他浏览器打开";
            document.getElementById("tipsp").innerHTML= "请用Safari浏览器打开";
        }
    }

    //判断手机上是否安装了app，如果安装直接打开，如果没安装，跳转到下载页面
    function openApp() {
        var timeOut;
        // 尝试打开 scheme
        if(isAndroid) {
            window.location.href = andScheme;
            timeOut = 2000;

            // 设置2秒的定时下载任务，2秒之后下载app
            downloader = setTimeout(function(){
                if(isAndroid) {
                    window.location.href = andDownload;
                }
                if(isIOS) {
                    window.location.href = iosDownload;
                }
            }, timeOut);
        }
        if(isIOS) {
            window.location.href = iosScheme;
            timeOut = 3000;
        }
    }

    document.addEventListener('visibilitychange webkitvisibilitychange', function () {
        // 如果页面隐藏，推测打开scheme成功，清除下载任务
        if (window.document.hidden || window.document.mozHidden || window.document.msHidden ||window.document.webkitHidden) {
            if(downloader){
                clearTimeout(downloader);
            }
        }
    });
    window.addEventListener('pagehide', function() {
        if(downloader){
            clearTimeout(downloader);
        }
    });


//        //这个是安卓操作系统
//        if (isAndroid) {
//            //安卓app的scheme协议
//            window.location.href = "scheme1://host1:8080/path1?query1=1&query2=true";
//            setTimeout(function(){
//                var hidden = window.document.hidden || window.document.mozHidden || window.document.msHidden ||window.document.webkitHidden;
//                if(typeof hidden =="undefined" || hidden ==false){
//                    // app下载地址
//                    window.location.href ="https://fir.im/mwcp";
//                }
//            }, 2000);
//        }
//        //这个是ios操作系统
//        if (isIOS) {
//            var url = "schemeDemo://host1:8080/path1?query1=1&query2=true";
//            window.location.href = url;
//            setTimeout(function(){
//                var hidden = window.document.hidden || window.document.mozHidden || window.document.msHidden ||window.document.webkitHidden;
//                if(typeof hidden =="undefined" || hidden ==false){
//                    // app下载地址
//                    var durl = "https://itunes.apple.com/us/app/zhe-jiang-yi-dong-shou-ji/id898243566#weixin.qq.com";
//                    window.location.href = durl;
//                }
//            }, 2000);
//
////            var timeout, t = 1000, hasApp = true;
////            var openScript = setTimeout(function () {
////                if (!hasApp) {
////                    var durl = "https://itunes.apple.com/us/app/zhe-jiang-yi-dong-shou-ji/id898243566#weixin.qq.com";
////                    window.location.href = durl;
////                }
////                document.body.removeChild(ifr);
////            }, 2000);
////
////            var t1 = Date.now();
////            var ifr = document.createElement("iframe");
////            ifr.setAttribute('src', url);
////            ifr.setAttribute('style', 'display:none');
////            document.body.appendChild(ifr);
////            timeout = setTimeout(function () {
////                var t2 = Date.now();
////                if (!t1 || t2 - t1 < t + 100) {
////                    hasApp = false;
////                }
////            }, t);
//        }
//    }
</script>

<body onload="load()"  style="height: 100%" id="body">
<div id='down' onclick="openApp()"><img height="120px" width="120px" src="./img/cat.png"><span style="font-size: 26px">尚盈车联</span></div>

<!--如果是微信内置浏览器会显示以下图标-->
<div id="tipsdiv" class="wtips" style="display: none">
    <p id="tipsp">请用其他浏览器打开</p>
</div>
</body>
</html>

