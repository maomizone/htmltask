<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8"/>
    <title>mdater</title>
    <link rel="stylesheet" href="css/zepto.mdater.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/util/zepto.js"></script>
    <script src="js/zepto.mdater.js"></script>
    <script src="js/util/jquery-3.2.1.min.js"></script>
    <script>jQuery.noConflict()</script>
    <script src="js/util/bootstrap.min.js"></script>
    <script src="js/common/app.js"></script>


</head>
<body>
<div id="ca"></div>
<div id="container"></div>

<div id="tip">
    <p>暂无预约</p>
    <p>有预约</p>
    <p>预约已满</p>
</div>

<div class="panel panel-default">
    <div class="panel-body">
        <div class="left">
            <p class="text-center"><strong id="date">2017.10.12</strong></p>
            <p class="text-center"><strong id="week">星期二</strong></p>
        </div>
        <div class="right">
            <p>已有预约 <strong id="num">0</strong> 位</p>
            <p class="text-center">
                <button id="look" type="button" class="btn btn-danger">查看预约</button>
            </p>
        </div>
    </div>
</div>
<script>
    var selectedDate;

    var data = [
        {
            date: '2017/11/19',
            value: 'Christmas Eve',
            type: 0,
        },
        {
            date: '2017/11/11',
            value: 'Merry Christmas',
            type: 1,
        },
    ];

    $(document).ready(function () {
        $('#ca').mdater({
            minDate: new Date(2015, 2, 10),
            data: [],
            onSelected: function (date, week) {
                console.log("js回调--》" + date + week);
                selectedDate = date;
                $("#date").text(date);
                $("#week").text(week);
            }
        });

        $('#ca').changeData(data);
        $('#ca').getNowDate();
        $("#look").click(function () {
            dsBridge.call(LOOK_APPOINT_FROM_JS, {date: selectedDate}, function (responseData) {
            })
        });

//        $('#ca').initListeners();
//
//        $('.md_datearea li').click(function () {
//        });
        console.log("屏幕宽度" + document.body.clientWidth);
        //手指接触屏幕
        document.getElementById("container").addEventListener("touchstart", function (e) {
            startx = e.touches[0].pageX;
            starty = e.touches[0].pageY;
        }, false);
        //手指离开屏幕
        document.getElementById("container").addEventListener("touchend", function (e) {
            var endx, endy;
            endx = e.changedTouches[0].pageX;
            endy = e.changedTouches[0].pageY;
            var direction = getDirection(startx, starty, endx, endy);
            switch (direction) {
                case 3:
                    console.log("右滑")
                    $('#ca').direction("right");
                    break;
                case 4:
                    console.log("左滑")
                    $('#ca').direction("left");
                    break;
                default:
            }
        }, false);
    });

    var startx, starty;
    //获得角度
    function getAngle(angx, angy) {
        return Math.atan2(angy, angx) * 180 / Math.PI;
    };

    //根据起点终点返回方向 1向上 2向下 3向左 4向右 0未滑动
    function getDirection(startx, starty, endx, endy) {
        var angx = endx - startx;
        var angy = endy - starty;
        var result = 0;

        //如果滑动距离太短
        if (Math.abs(angx) < 2 && Math.abs(angy) < 2) {
            return result;
        }

        var angle = getAngle(angx, angy);
        if (angle >= -135 && angle <= -45) {
            result = 1;
        } else if (angle > 45 && angle < 135) {
            result = 2;
        } else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
            result = 3;
        } else if (angle >= -45 && angle <= 45) {
            result = 4;
        }

        return result;
    }
</script>
</body>
</html>
