<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8"/>
    <title>mdater</title>

    <!--css-->
    <link rel="stylesheet" href="css/zepto.mdater.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/app.css">
    <!--加载框-->
    <link rel="stylesheet" href="css/iosOverlay.css">
    <!--吐司-->
    <link rel="stylesheet" href="css/toast.css">

    <!--js-->
    <script src="js/util/zepto.js"></script>
    <script src="js/util/jquery-3.2.1.min.js"></script>
    <script>jQuery.noConflict()</script>
    <script src="js/util/bootstrap.min.js"></script>

    <!--加载框-->
    <script src="js/util/spin.min.js"></script>
    <script src="js/util/jquery.spin.js"></script>
    <script src="js/util/iosOverlay.js"></script>
    <!--吐司-->
    <script src="js/util/toast.js"></script>
    <!--custom-->
    <script src="js/common/app.js"></script>
    <script src="js/common/tool.js"></script>
    <script src="js/zepto.mdater.js"></script>


</head>
<body>
<div id="ca"></div>
<div id="container"></div>

<div id="tip">
    <div>
        <img src="img/no_appoint.png">
        <span>暂无预约</span>
    </div>
    <div>
        <img src="img/kuang_has_appoint.png">
        <span>有预约</span>
    </div>
    <div>
        <img src="img/kuang_appoint_full.png">
        <span>预约已满</span>
    </div>

</div>

<div class="panel panel-default">
    <div class="panel-body">
        <div class="left">
            <p class="text-center"><strong id="date">2017.10.12</strong></p>
            <p class="text-center"><strong id="week">星期二</strong></p>
        </div>
        <div class="right">
            <p>已有预约 <strong id="num">0</strong> 位</p>
            <p class="text-center">
                <button id="look" type="button" class="btn btn-danger">查看预约</button>
            </p>
        </div>
    </div>
</div>


<script>
    var selectedDate;

    var data = [
        {
            day: '2017-12-19',
            value: 'Christmas Eve',
            state: 1,
        },
        {
            day: '2017-12-11',
            value: 'Merry Christmas',
            state: 2,
        },
    ];

    $(document).ready(function () {
        $('#ca').mdater({
            minDate: new Date(2015, 2, 10),
            data: [],
            onSelected: function (date, week) {
                console.log("js回调--》" + date + week);
                selectedDate = date;
                $("#date").text(date);
                $("#week").text(week);
            }
        });

//        $('#ca').changeData(data);
        $('#ca').getNowDate();
        $("#look").click(function () {
            dsBridge.call(LOOK_APPOINT_FROM_JS, {date: selectedDate}, function (responseData) {
            })
        });

        $('#ca').initListeners();

        $('.md_datearea li').click(function () {
        });


        console.log("屏幕宽度" + document.body.clientWidth);
        //手指接触屏幕
        document.getElementById("container").addEventListener("touchstart", function (e) {
            startx = e.touches[0].pageX;
            starty = e.touches[0].pageY;
        }, false);
        //手指离开屏幕
        document.getElementById("container").addEventListener("touchend", function (e) {
            var endx, endy;
            endx = e.changedTouches[0].pageX;
            endy = e.changedTouches[0].pageY;
            var direction = getDirection(startx, starty, endx, endy);
            switch (direction) {
                case 3:
                    console.log("右滑")
                    $('#ca').direction("right");
                    break;
                case 4:
                    console.log("左滑")
                    $('#ca').direction("left");
                    break;
                default:
            }
        }, false);

        work_calendar_list();
    });

    var startx, starty;
    //获得角度
    function getAngle(angx, angy) {
        return Math.atan2(angy, angx) * 180 / Math.PI;
    };

    //根据起点终点返回方向 1向上 2向下 3向左 4向右 0未滑动
    function getDirection(startx, starty, endx, endy) {
        var angx = endx - startx;
        var angy = endy - starty;
        var result = 0;

        //如果滑动距离太短
        if (Math.abs(angx) < 2 && Math.abs(angy) < 2) {
            return result;
        }

        var angle = getAngle(angx, angy);
        if (angle >= -135 && angle <= -45) {
            result = 1;
        } else if (angle > 45 && angle < 135) {
            result = 2;
        } else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
            result = 3;
        } else if (angle >= -45 && angle <= 45) {
            result = 4;
        }

        return result;
    }

    /**
     * 获取单月工作日历列表
     */
    function work_calendar_list() {

//        showLoading();
        var obj = {};
        obj.serviceUserID = "000b34b9-0000-0000-0000-000028e4a3af";
        obj.year = "2017";
        obj.month = "12";

        $.ajax({
            url:BASE_URL + "work_calendar_list",
            type:"POST",
            data: obj,
            timeout:1000*10,
            dataType:"json",

            success:function (data,textStatus,jqXHR) {
//                hideLoading();
                // 返回结果状态值,值为0或1.(0表示请求失败；1表示请求成功)
                if(data.status == 1){
                    console.log(data);
                    if(data.dayList && data.dayList.length > 0){
                        var markData = [];
                        for(var i = 0; i < data.dayList.length; i++){
                            var item = data.dayList[i];
//                            if(i == 11 || i == 29){
//                                item.state = 1;
//                            }
                            if(item.state > 0){
                                markData.push(item)
                            }
                        }
                        console.log("markData.length-->" + markData.length);
                        $('#ca').changeData(markData);
                    }
                }else {
//                    showMessage(data.info);
                }
            },
            error:function (xhr,textStatus) {
//                showMessage(NET_ERROR);
                console.log("错误信息如下====================");
                console.log(xhr);
                console.log(textStatus);
            },
        });
    }
</script>
</body>
</html>